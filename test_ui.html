<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Testi UI – Lennokit</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    button { margin: 5px 0; padding: 10px; }
    pre { background: #f4f4f4; padding: 10px; max-height: 400px; overflow: auto; }
  </style>
</head>
<body>
  <h2>Testi UI – Lennokit</h2>

  <button onclick="haeLennokit()">Hae lennokit</button>
  <button onclick="haeAktiivinen()">Hae aktiivinen lennokki</button>
  <button onclick="haeOsat()">Hae osat ja kokoonpanot</button>
  <button onclick="haeYhteenveto()">Hae yhteenveto</button>
  <button onclick="callAppsScript('ping')">Testaa Ping</button>

  <h3>Tulos:</h3>
  <pre id="tulos">Ei dataa vielä</pre>

  <!-- =========================
       User-moduuli
       ========================= -->
  <script>
    const User = {
      id: "rc.hietaneva@gmail.com", // testikäyttäjä
      getId: function() { return this.id; },
      setId: function(newId) { this.id = newId; }
    };
  </script>

  <!-- =========================
       Apps Script fetch
       ========================= -->
  <script>
    const tulosEl = document.getElementById('tulos');

    // Yhtenäinen paikka Google Apps Script URLille
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxVJiqnBPDqjmP98RPCJjBRSYEZVMhaJib5N3CnpSvGKVtIfzWlKOHl-B3axyAMVP0Z/exec";

    async function callAppsScript(action) {

      console.log("CALL LÄHTEE:", action);
    
        try {
          const body = {
            action: action,
            userId: User.getId()
          };
      
          console.log("BODY:", body);
      
          const options = {
            method: "POST",
            headers: { "Content-Type": "text/plain" },
            body: JSON.stringify(body)
          };
      
          const response = await fetch(SCRIPT_URL, options);
      
          console.log("STATUS:", response.status);
      
          const text = await response.text();
          console.log("RAW RESPONSE:", text);
      
          tulosEl.textContent = text;
      
        } catch (err) {
          console.error("FETCH ERROR:", err);
          tulosEl.textContent = "Virhe: " + err;
        }
    }

    
    // =========================
    // Napit
    // =========================
    function haeLennokit() {
      callAppsScript('haeLennokitAloitukseen');
    }

    function haeAktiivinen() {
      callAppsScript('haeAktiivinenLennokkiId');
    }

    function haeOsat() {
      callAppsScript('haeOsat');
    }

    function haeYhteenveto() {
      callAppsScript('haeYhteenveto');
    }
  </script>
</body>
</html>
